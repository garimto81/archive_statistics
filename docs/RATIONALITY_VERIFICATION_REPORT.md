# 영상 길이 기반 완료 기준 합리성 검토 보고서

**작성일**: 2025-12-09
**버전**: 1.0
**목적**: "영상 길이 90% 지점까지 분석 = 완료" 기준의 합리성 검증

---

## 1. 검토 대상 기준

### 제안된 완료 판단 로직
```
완료 조건: max(time_end) >= video_duration × 0.9
```

- **T_max**: 해당 영상에서 분석된 핸드 중 가장 마지막 타임코드
- **D**: 영상 전체 길이
- **기준**: T_max가 영상 길이의 90% 이상이면 "완료"

---

## 2. Google Sheets 데이터 구조 분석

### Sheet 1: WSOP Hand Database (500+ records)
| 필드 | 데이터 형식 | 의미 |
|------|-------------|------|
| `time_start_ms` | INTEGER (밀리초) | 핸드 시작 시점 |
| `time_end_ms` | INTEGER (밀리초) | 핸드 종료 시점 |

### Sheet 2: WSOP Circuit LA (38 records)
| 필드 | 데이터 형식 | 의미 |
|------|-------------|------|
| `In` | HH:MM:SS | 클립 시작 시간 |
| `Out` | HH:MM:SS | 클립 종료 시간 |
| `File Name` | TEXT | 원본 영상 파일명 |

---

## 3. 합리성 검토

### 3.1 ✅ 타당한 점

#### A. 순차적 분석 워크플로우 반영
```
포커 영상 분석 작업 흐름:
1. 영상 시작 → 첫 핸드 분석
2. 중간 → 핸드들 연속 분석
3. 영상 끝 → 마지막 핸드 분석
   └── 90% 지점 도달 = 거의 모든 핸드 분석 완료
```

**근거**: 분석자는 영상을 처음부터 끝까지 순차적으로 보며 핸드를 기록합니다.
마지막 타임코드가 영상 끝부분에 있다면, 그 앞의 모든 내용도 검토했다고 판단할 수 있습니다.

#### B. 엔딩 크레딧/빈 구간 고려
```
일반적인 포커 방송 영상 구조:
[0%]──────[핸드 콘텐츠 영역]──────[90%]──[엔딩/크레딧]──[100%]
                                   ↑
                            분석 대상 종료 지점
```

**근거**: 대부분의 영상은 마지막 5-10%에 엔딩 크레딧, 스폰서 로고,
빈 화면 등 분석 불필요 구간이 있습니다. 90%는 이를 적절히 고려한 기준입니다.

#### C. 하나의 영상 = 수백 개의 핸드
```
예시 (Sheet 1 기준):
- 1개 영상 (2시간 = 7,200초)
- 핸드 수: 100-300개
- 핸드당 평균 길이: 24-72초

판단 기준 비교:
❌ 잘못된 방법: 필드 완성도 (각 핸드의 태그 완성률)
   → 1개 핸드만 완벽히 분석해도 "높은 완성도"로 오판

✅ 올바른 방법: 영상 커버리지 (타임코드 기반)
   → 영상 전체를 얼마나 분석했는지 측정
```

### 3.2 ⚠️ 주의사항

#### A. 건너뛴 구간 미감지
```
시나리오: 선별적 분석
[0%]──[분석]──[20%]──────[건너뜀]──────[85%]──[분석]──[95%]
                  ↑                              ↑
            미분석 구간 65%              max(time_end) = 95%

결과: 95% > 90% → "완료"로 판정 (실제 분석률 30%)
```

**대응 방안**:
- 밀도 검증: `핸드 개수 / 영상 길이` 비율 확인
- 구간별 분포 검증: 10분 단위 핸드 분포 체크

#### B. 영상 길이 정보 필요
```
필요 데이터:
1. video_duration (영상 전체 길이) ← 현재 없음
2. time_end_ms (분석된 마지막 타임코드) ← 시트에 존재

해결 방법:
- ffprobe로 NAS 영상 파일 길이 추출
- DB에 file_stats.duration 필드 추가
```

### 3.3 📊 예상 시나리오 분석

| 케이스 | max(time_end) | video_duration | 90% 기준 | 판정 | 적정성 |
|--------|--------------|----------------|----------|------|--------|
| A | 6,480초 | 7,200초 (2h) | 6,480초 | ✅ 완료 | ✅ 적정 |
| B | 6,000초 | 7,200초 (2h) | 6,480초 | ❌ 진행중 | ✅ 적정 |
| C | 7,000초 | 7,200초 (2h) | 6,480초 | ✅ 완료 | ✅ 적정 |
| D | 100초 | 7,200초 (2h) | 6,480초 | ❌ 진행중 | ✅ 적정 |

---

## 4. 검증 결과

### 4.1 결론: ✅ 합리적인 기준

**영상 길이 기반 90% 완료 기준은 합리적입니다.**

| 평가 항목 | 점수 | 설명 |
|-----------|------|------|
| 실용성 | 9/10 | 간단하고 직관적인 판단 기준 |
| 정확성 | 7/10 | 순차 분석 가정 시 높은 정확도 |
| 구현 용이성 | 8/10 | ffprobe + MAX() 쿼리로 구현 가능 |
| 엣지 케이스 | 6/10 | 건너뛴 구간 감지 불가 (보완 필요) |

### 4.2 권장 보완 사항

```sql
-- 완료 판정 쿼리 (권장)
SELECT
    file_name,
    MAX(time_end_s) as max_timecode,
    video_duration,
    COUNT(*) as hand_count,
    MAX(time_end_s) / video_duration as coverage_ratio,
    COUNT(*) / (video_duration / 60.0) as hands_per_minute,
    CASE
        WHEN MAX(time_end_s) >= video_duration * 0.9
         AND COUNT(*) / (video_duration / 60.0) >= 0.5  -- 최소 밀도 조건
        THEN 'COMPLETE'
        ELSE 'IN_PROGRESS'
    END as status
FROM poker_hands
GROUP BY file_name;
```

**보완 조건**:
- 기본: `max(time_end) >= duration × 0.9`
- 추가: `핸드밀도 >= 0.5 hands/분` (선택적)

---

## 5. 최종 판정

| 항목 | 판정 |
|------|------|
| **"영상 길이 90% 기반 완료 판단"** | ✅ **합리적** |
| **단일 핸드 필드 완성도 기반** | ❌ **부적절** |

### 이유 요약

1. **1영상 = 수백 핸드**: 필드 완성도는 개별 핸드 품질 측정용이지, 전체 작업 진척도 측정에 부적합
2. **순차 분석 워크플로우**: 마지막 타임코드가 끝부분이면 앞부분도 검토했다고 추정 가능
3. **엔딩 구간 고려**: 90%는 실제 콘텐츠 영역의 끝을 의미하는 합리적 수치
4. **구현 가능성**: ffprobe + SQL MAX() 조합으로 자동화 가능

---

## 6. 다음 단계

1. **영상 길이 데이터 확보**: NAS 스캔 시 ffprobe로 duration 추출
2. **DB 스키마 확장**: `file_stats.duration_seconds` 컬럼 추가
3. **완료 판정 API**: `/api/progress/{file_id}` 엔드포인트 구현
4. **대시보드 표시**: 파일별 완료율 시각화

---

*이 보고서는 Google Sheets 데이터 구조 분석을 기반으로 작성되었습니다.*
