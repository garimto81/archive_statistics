# PRD: Progress Overview 현황 분석 및 구조 검토

**PRD**: 0008 | **Version**: 1.2.0 | **Date**: 2025-12-12 | **Status**: 구현 예정
**목적**: Progress Overview - NAS/Sheets 데이터 분리 표시
**Issue**: [#29](https://github.com/garimto81/archive_statistics/issues/29)

---

## 1. 현재 시스템 구조 (내가 이해한 것)

### 1.1 데이터 소스 (3개)

```
┌─────────────────────────────────────────────────────────────────────┐
│                         데이터 소스 개요                              │
├─────────────────────────────────────────────────────────────────────┤
│                                                                     │
│  1. NAS (실제 파일 시스템)                                           │
│     \\10.10.100.122\docker\GGPNAs\ARCHIVE                           │
│     └── DB: folder_stats, file_stats                                │
│     └── 역할: 실제 폴더/파일 구조, 용량, duration                     │
│                                                                     │
│  2. Google Sheets (작업 현황)                                        │
│     └── DB: work_statuses (동기화됨)                                 │
│     └── 역할: 담당자(PIC), 작업 상태, excel_done/total_videos         │
│                                                                     │
│  3. Metadata DB (핸드 분석 결과)                                     │
│     └── DB: hand_analysis                                           │
│     └── 역할: 파일별 분석된 핸드 정보, timecode                       │
│                                                                     │
└─────────────────────────────────────────────────────────────────────┘
```

### 1.2 DB 스키마 구조

```
┌─────────────────────────────────────────────────────────────────────┐
│                              DB 스키마                               │
├─────────────────────────────────────────────────────────────────────┤
│                                                                     │
│  folder_stats (NAS 스캔 결과)                                        │
│  ├── id, path (unique), name                                        │
│  ├── parent_path (부모 폴더 경로)                                    │
│  ├── depth (0=루트)                                                 │
│  ├── total_size, file_count, folder_count, total_duration           │
│  └── work_status_id (FK → work_statuses.id) ← 명시적 연결           │
│                                                                     │
│  file_stats (NAS 파일)                                              │
│  ├── id, path (unique), name, folder_path                           │
│  ├── extension, size, duration                                      │
│  └── video_codec, audio_codec                                       │
│                                                                     │
│  work_statuses (Google Sheets 동기화)                                │
│  ├── id, archive_id (FK), category (매칭 키)                        │
│  ├── pic (담당자), status (pending/in_progress/completed)            │
│  ├── total_videos (시트 원본값), excel_done (완료 개수)              │
│  └── progress_percent, notes1, notes2                               │
│                                                                     │
│  hand_analysis (Metadata DB)                                        │
│  ├── id, file_name (매칭 키)                                        │
│  ├── timecode_in, timecode_out, timecode_in_sec, timecode_out_sec   │
│  └── hand_grade, winner, hands                                      │
│                                                                     │
└─────────────────────────────────────────────────────────────────────┘
```

### 1.3 NAS 폴더 구조 (예시)

```
ARCHIVE/                           ← depth=0, 루트
├── WSOP/                          ← depth=1, 대분류
│   ├── WSOP-EUROPE/               ← depth=2, 시리즈
│   │   ├── 2023/                  ← depth=3, 연도
│   │   │   └── [video files]
│   │   └── 2024/
│   ├── WSOP-LAS-VEGAS/
│   │   └── 2025/
│   └── WSOP-PARADISE/
├── HCL/
│   ├── HCL_S1/
│   └── HCL_S2/
├── GOG/
│   └── GOG_MAIN/
└── PAD/
    ├── PAD S12/
    └── PAD S13/
```

### 1.4 Google Sheets 데이터 구조 (work_statuses)

| category | pic | status | total_videos | excel_done |
|----------|-----|--------|--------------|------------|
| WSOP-EUROPE | 김OO | in_progress | 120 | 95 |
| WSOP-LAS-VEGAS | 이OO | completed | 80 | 80 |
| WSOP-PARADISE | 박OO | pending | 50 | 0 |
| 2025 WSOP | 최OO | in_progress | 200 | 150 |
| HCL_S1 | 김OO | completed | 45 | 45 |
| PAD S12 | - | pending | 30 | 0 |

**핵심**: `category` 컬럼이 폴더명과 매칭되어야 진행률 표시됨

---

## 2. 현재 매칭 로직 (내가 이해한 것)

### 2.1 폴더 ↔ work_status 매칭

```
매칭 방법 (우선순위):
1. FK 기반: folder_stats.work_status_id → work_statuses.id (명시적 연결)
2. Fuzzy Matching: folder.name ↔ work_status.category (문자열 비교)

Fuzzy Matching 전략 (점수순):
┌──────────────────┬───────┬─────────────────────────────────────┐
│ 전략             │ 점수  │ 예시                                │
├──────────────────┼───────┼─────────────────────────────────────┤
│ exact            │ 1.0   │ "GOG" == "GOG"                      │
│ exact_normalized │ 0.98  │ "WSOP-EUROPE" == "WSOP_EUROPE"      │
│ prefix           │ 0.9   │ 카테고리 "PAD S12" → 폴더 "PAD"     │
│ subset           │ 0.88~ │ 카테고리 "2025 WSOP" ⊆ 폴더 단어들  │
│ folder_prefix    │ 0.85  │ 폴더 "GOG 최종" → 카테고리 "GOG"    │
│ word             │ 0.8   │ 폴더 "WSOP" ∈ 카테고리 단어         │
│ year             │ 0.7   │ 폴더 "2023" ∈ 카테고리 단어         │
└──────────────────┴───────┴─────────────────────────────────────┘
```

### 2.2 Cascading Match 방지 (Issue #24)

**문제**: 상위 폴더와 하위 폴더가 동일한 work_status에 매칭되면 excel_done 중복 합산

```
예시 (버그 발생 시):
WSOP/                    ← "WSOP" 카테고리 매칭 (done: 100)
├── WSOP-EUROPE/         ← "WSOP-EUROPE" 매칭 (done: 27)
├── WSOP-LAS-VEGAS/      ← "WSOP-LAS-VEGAS" 매칭 (done: 9)
└── WSOP-PARADISE/       ← "WSOP-PARADISE" 매칭 (done: 9)

문제: "WSOP" 폴더가 "WSOP LA" 같은 카테고리에도 매칭되면
      → 부모-자식 모두에서 동일 excel_done 합산 → 과대 표시
```

**현재 해결책**:
- `parent_work_status_ids`: 상위 폴더에서 매칭된 ID를 하위에서 제외
- `sibling_used_ids`: 형제 폴더에서 매칭된 ID도 제외
- 단일 매칭 정책: 각 work_status는 한 폴더에만 매칭

### 2.3 진행률 계산

```python
# work_summary (폴더별 작업 진행률)
combined_progress = (excel_done / folder.file_count) * 100  # NAS 기준
actual_progress = (excel_done / total_videos) * 100         # 시트 기준

# 90% 이상은 100%로 처리
if combined_progress >= 90:
    combined_progress = 100.0
```

---

## 3. 현재 발생하는 오류들 (추정)

### 3.1 매칭 실패 유형

| 증상 | 원인 (추정) |
|------|------------|
| 폴더에 진행률 바가 없음 | 매칭된 work_status 없음 (category 불일치) |
| 진행률이 0%로 표시 | excel_done이 0이거나 매칭 무효화 |
| 진행률이 비정상적으로 높음 | Cascading Match로 중복 합산 |
| 자식 폴더만 표시되고 부모는 없음 | 부모가 모든 work_status를 점유 |

### 3.2 데이터 불일치 유형

| 증상 | 원인 |
|------|------|
| `total_done > file_count` | 시트의 total_videos ≠ NAS 실제 파일 수 → 매칭 무효화됨 |
| `mismatch_count` 경고 | 시트 total_videos와 NAS file_count 10% 이상 차이 |

### 3.3 UI 표시 오류

| 증상 | 원인 (추정) |
|------|------------|
| work_summary가 null | 직접 매칭 없음 (자식 합산 제거됨) |
| 시트 아이콘(📊)이 이상한 값 표시 | sheets_excel_done/sheets_total_videos 계산 오류 |

---

## 4. 데이터 흐름도 (현재)

```
┌─────────────────────────────────────────────────────────────────────┐
│                    Progress Overview 데이터 흐름                      │
├─────────────────────────────────────────────────────────────────────┤
│                                                                     │
│  [1] API 호출                                                        │
│  GET /api/progress/tree?depth=3&include_files=true                  │
│       │                                                             │
│       ▼                                                             │
│  [2] 데이터 로드 (progress_service.py)                               │
│       ├── _load_work_statuses() → Dict[category, ws_info]           │
│       └── _load_hand_analysis_data() → Dict[file_name, hand_info]   │
│       │                                                             │
│       ▼                                                             │
│  [3] 폴더 조회                                                       │
│       SELECT * FROM folder_stats WHERE depth=0 ORDER BY size DESC   │
│       │                                                             │
│       ▼                                                             │
│  [4] 폴더별 매칭 (재귀)                                              │
│       _build_folder_progress()                                      │
│       │                                                             │
│       ├── [4-1] work_status 매칭                                    │
│       │    ├── FK 확인: folder.work_status_id → ws                  │
│       │    └── Fuzzy: _match_work_statuses(folder.name, available)  │
│       │         └── available = all_ws - parent_used - sibling_used │
│       │                                                             │
│       ├── [4-2] work_summary 계산                                   │
│       │    ├── 매칭 성공 → {task_count, total_done, progress...}    │
│       │    └── 매칭 실패 → null (진행률 바 없음)                     │
│       │                                                             │
│       ├── [4-3] 자식 폴더 재귀 호출                                  │
│       │    └── parent_work_status_ids 전파 (Cascading 방지)         │
│       │                                                             │
│       └── [4-4] 결과 반환                                           │
│            └── (folder_dict, used_work_status_ids)                  │
│       │                                                             │
│       ▼                                                             │
│  [5] Frontend 렌더링                                                 │
│       FolderTreeWithProgress.tsx                                    │
│       ├── work_summary 있음 → ProgressBar 표시                      │
│       └── work_summary 없음 → 회색 빈 바 표시                        │
│                                                                     │
└─────────────────────────────────────────────────────────────────────┘
```

---

## 5. 핵심 질문 (확인 필요)

### 5.1 매칭 로직 관련

1. **Google Sheets의 `category` 컬럼은 NAS 폴더명과 어떤 규칙으로 작성되나요?**
   - 정확히 동일? (예: 폴더 "WSOP-EUROPE" = 시트 "WSOP-EUROPE")
   - 다른 명명 규칙? (예: 폴더 "WSOP-EUROPE" = 시트 "WSOP EUROPE")
   - 계층 구조? (예: 폴더 "WSOP/WSOP-EUROPE" = 시트 "WSOP-EUROPE")

2. **하나의 work_status는 여러 폴더에 적용될 수 있나요?**
   - 현재 로직: 1:1 매칭 (한 work_status = 한 폴더)
   - 실제 의도: 1:N? (예: "WSOP 2024" 카테고리가 여러 하위 폴더에?)

3. **부모 폴더에 진행률을 표시해야 하나요?**
   - 현재 로직: 직접 매칭된 폴더만 표시 (자식 합산 X)
   - 의도: 자식 폴더들의 합계를 부모에 표시?

### 5.2 진행률 계산 관련

4. **진행률의 분모는 무엇인가요?**
   - 현재: `folder.file_count` (NAS 실제 파일 수)
   - 대안: `work_status.total_videos` (시트 입력값)

5. **폴더의 `file_count`는 하위 폴더 파일도 포함하나요?**
   - 현재 이해: 포함 (FolderStats는 하위 전체 집계)
   - 확인 필요

### 5.3 현재 오류 상황

6. **어떤 폴더에서 어떤 오류가 발생하나요?**
   - 구체적인 폴더명과 증상
   - 예상 값 vs 실제 표시 값

---

## 6. 구현 목표 (확인 필요)

### 6.1 기대 동작

```
시나리오 A: 정확한 매칭
┌─────────────────────────────────────────────────────────────────┐
│ 폴더: WSOP-EUROPE                                               │
│ 매칭: work_status.category = "WSOP-EUROPE"                      │
│       → total_videos=120, excel_done=95                         │
│ 표시: [████████████████░░░░] 79% (95/120)                       │
└─────────────────────────────────────────────────────────────────┘

시나리오 B: 매칭 없음
┌─────────────────────────────────────────────────────────────────┐
│ 폴더: NEW_FOLDER (시트에 없음)                                   │
│ 매칭: 없음                                                       │
│ 표시: [░░░░░░░░░░░░░░░░░░░░] - (회색 빈 바)                      │
└─────────────────────────────────────────────────────────────────┘

시나리오 C: 계층 구조
┌─────────────────────────────────────────────────────────────────┐
│ WSOP/                        ← 매칭: "WSOP" (50%)               │
│ ├── WSOP-EUROPE/             ← 매칭: "WSOP-EUROPE" (79%)        │
│ └── WSOP-LAS-VEGAS/          ← 매칭: "WSOP-LAS-VEGAS" (100%)    │
│                                                                 │
│ 질문: WSOP 폴더는 자체 매칭인가, 자식 합산인가?                   │
└─────────────────────────────────────────────────────────────────┘
```

### 6.2 현재 로직의 의도 확인

| 항목 | 현재 구현 | 의도대로인가? |
|------|----------|--------------|
| 매칭 방식 | 1 work_status : 1 folder | ? |
| 부모 폴더 진행률 | 직접 매칭만 (자식 합산 X) | ? |
| 진행률 분모 | NAS file_count | ? |
| 90% 이상 → 100% | 적용됨 | ? |
| Cascading 방지 | 적용됨 | ? |

---

## 7. 목업 디자인 (현재 구현된 UI)

### 7.1 전체 Dashboard 레이아웃

```
┌─────────────────────────────────────────────────────────────────────────────┐
│  Archive Statistics                                              [Settings] │
├─────────────────────────────────────────────────────────────────────────────┤
│                                                                             │
│  ┌─────────────────────────────────────────────────────────────────────────┐│
│  │  Extension Filter                                                       ││
│  │  [.mp4 ✓] [.mkv ✓] [.mov] [.avi] [.ts]  ... [Clear All]                ││
│  └─────────────────────────────────────────────────────────────────────────┘│
│                                                                             │
│  ┌───────────────┐ ┌───────────────┐ ┌───────────────┐ ┌───────────────┐   │
│  │ Total Files   │ │ Total Size    │ │ Media Duration│ │ Match Rate    │   │
│  │    12,345     │ │    850TB      │ │    2,500h     │ │     78%       │   │
│  │ 8,900 w/hands │ │ 1,234 folders │ │ 45,000 hands  │ │ 150/192 done  │   │
│  └───────────────┘ └───────────────┘ └───────────────┘ └───────────────┘   │
│                                                                             │
│  ┌─────────────────────────────────────┬───────────────────────────────────┐│
│  │                                     │                                   ││
│  │    Progress Overview (Left 2/3)     │    Right Panel (1/3)              ││
│  │    (FolderTreeWithProgress)         │                                   ││
│  │                                     │                                   ││
│  │                                     │                                   ││
│  └─────────────────────────────────────┴───────────────────────────────────┘│
│                                                                             │
└─────────────────────────────────────────────────────────────────────────────┘
```

### 7.2 Progress Overview 컴포넌트 상세

```
┌─────────────────────────────────────────────────────────────────────────────┐
│  Progress Overview                                                    [↻]   │
├─────────────────────────────────────────────────────────────────────────────┤
│  범례: [작업중] 엑셀 작업 현황  [━━] 진행률  [━━] 완료                        │
├─────────────────────────────────────────────────────────────────────────────┤
│                                                                             │
│  ▼ 📂 WSOP                    744개 · 125TB   [━━━━━━━░░░] 65% (45/69) 📊   │
│     ▼ 📂 WSOP-EUROPE          120개 · 25TB    [━━━━━━━━░░] 79% (95/120) 📊  │
│        ▶ 📂 2023              45개 · 10TB     [━━━━━━━━━━] 100% (45/45) 📊  │
│        ▶ 📂 2024              75개 · 15TB     [━━━━━━━░░░] 67% (50/75) 📊   │
│     ▼ 📂 WSOP-LAS-VEGAS       200개 · 40TB    [━━━━━━━━━━] 100% (80/80) 📊  │
│        ▶ 📂 2024              200개 · 40TB    [━━━━━━━━━━] 100%             │
│     ▶ 📂 WSOP-PARADISE        50개 · 12TB     [░░░░░░░░░░] 0% (0/50) 📊    │
│                                                                             │
│  ▼ 📂 HCL                     500개 · 80TB    [━━━━━━━━━━] 100%             │
│     ▶ 📂 HCL_S1               45개 · 8TB      [━━━━━━━━━━] 100% (45/45) 📊  │
│     ▶ 📂 HCL_S2               120개 · 22TB    [━━━━━░░░░░] 50% (60/120) 📊 │
│                                                                             │
│  ▶ 📂 GOG                     300개 · 50TB    [━━━━━━░░░░] 62%              │
│                                                                             │
│  ▶ 📂 PAD                     180개 · 35TB    [░░░░░░░░░░] - (매칭 없음)    │
│                                                                             │
└─────────────────────────────────────────────────────────────────────────────┘

각 행의 구성:
┌──────┬────────────────────┬──────────────┬─────────────────────┬──────────┐
│ 아이콘 │ 폴더명              │ 파일수·용량  │ 프로그레스바+%      │ 시트아이콘│
├──────┼────────────────────┼──────────────┼─────────────────────┼──────────┤
│ ▼ 📂 │ WSOP-EUROPE        │ 120개 · 25TB │ [━━━━━━━━░░] 79%    │ 📊       │
│      │                    │              │ (95/120)            │          │
└──────┴────────────────────┴──────────────┴─────────────────────┴──────────┘

프로그레스바 상태:
- [━━━━━━━━━━] 녹색 100%: combined_progress >= 90
- [━━━━━━░░░░] 파란색 N%: 0 < combined_progress < 90
- [░░░░░░░░░░] 회색 -: work_summary가 null (매칭 없음)
```

### 7.3 폴더 노드 (FolderNode) 렌더링 로직

```
┌─────────────────────────────────────────────────────────────────────────────┐
│  FolderNode 렌더링 결정 트리                                                 │
├─────────────────────────────────────────────────────────────────────────────┤
│                                                                             │
│  folder 데이터 수신                                                          │
│       │                                                                     │
│       ▼                                                                     │
│  work_summary 있나? ─────────────────────────────────────────────────┐      │
│       │                                                              │      │
│       │ Yes                                                          │ No   │
│       ▼                                                              ▼      │
│  ┌─────────────────────────────────┐    ┌─────────────────────────────┐    │
│  │ ProgressBar 표시                │    │ 회색 빈 바 표시              │    │
│  │ - metadataProgress: combined_   │    │ <div class="bg-gray-200">   │    │
│  │   progress                      │    │   <div class="bg-gray-300   │    │
│  │ - isComplete: >= 100            │    │         w-0" />             │    │
│  │ - 색상: 파란색 또는 녹색         │    │ </div>                      │    │
│  └─────────────────────────────────┘    │ 텍스트: "-"                 │    │
│       │                                  └─────────────────────────────┘    │
│       ▼                                                                     │
│  📊 아이콘 표시 (sheets 값 툴팁)                                             │
│  title={`📊 시트: ${sheets_excel_done}/${sheets_total_videos}`}             │
│                                                                             │
└─────────────────────────────────────────────────────────────────────────────┘
```

### 7.4 Right Panel (상세 정보)

```
┌───────────────────────────────────────┐
│  Folder Detail (선택된 폴더)          │
├───────────────────────────────────────┤
│  📁 WSOP-EUROPE                       │
│  /mnt/nas/ARCHIVE/WSOP/WSOP-EUROPE    │
├───────────────────────────────────────┤
│  구분              │ 값               │
│  ─────────────────┼─────────────────  │
│  📁 NAS 파일 수    │            120   │
│  📊 시트 전체      │            120   │
│  ✅ 시트 완료      │             95   │
│  📈 진행률         │          79.2%   │
├───────────────────────────────────────┤
│  [━━━━━━━━━━━━━━━━░░░░] 79%          │
├───────────────────────────────────────┤
│  파일 수  │ 120                        │
│  용량     │ 25TB                       │
├───────────────────────────────────────┤
│  📊 Google Sheets 원본 데이터 (1행)   │
│  ┌─────────────────────────────────┐  │
│  │ WSOP-EUROPE          [in_prog] │  │
│  │ PIC: 김OO                      │  │
│  │ Total: 120                     │  │
│  │ Done: 95                       │  │
│  │ Progress: 79.2%                │  │
│  │ [━━━━━━━━░░] 79%               │  │
│  └─────────────────────────────────┘  │
├───────────────────────────────────────┤
│  파일 목록 (120)                      │
│  📹 video_001.mp4  01:23:45           │
│  📹 video_002.mp4  00:58:32           │
│  📹 video_003.mp4  01:45:00           │
│  ...                                  │
└───────────────────────────────────────┘

┌───────────────────────────────────────┐
│  Data Source Status                   │
├───────────────────────────────────────┤
│  NAS        ● Connected    2min ago   │
│  Archive DB ● Synced       5min ago   │
│  Metadata   ● Synced       10min ago  │
└───────────────────────────────────────┘

┌───────────────────────────────────────┐
│  Progress Summary                     │
├───────────────────────────────────────┤
│  📁 Filtered by:              [Clear] │
│  WSOP/WSOP-EUROPE                     │
├───────────────────────────────────────┤
│  NAS Folders          │          15   │
│  NAS Files            │         744   │
│  ─────────────────────┼─────────────  │
│  [archive] Tasks      │          12   │
│  [archive] Completed  │           8   │
│  ─────────────────────┼─────────────  │
│  [metadata] Hands     │       2,500   │
│  [metadata] Worksheets│          45   │
└───────────────────────────────────────┘
```

### 7.5 파일 노드 (include_files=true 일 때)

```
┌─────────────────────────────────────────────────────────────────────────────┐
│  파일 노드 렌더링                                                            │
├─────────────────────────────────────────────────────────────────────────────┤
│                                                                             │
│     ▼ 📂 WSOP-EUROPE          120개 · 25TB    [━━━━━━━━░░] 79%              │
│        📹 video_001.mp4        01:23:45       [━━━━━━━━░░] 85%              │
│        📹 video_002.mp4        00:58:32       [━━━━━━━━━━] 100% ✓           │
│        📹 video_003.mp4        01:45:00       [░░░░░░░░░░] 0%               │
│                                                                             │
│  파일별 프로그레스:                                                          │
│  - metadata_progress.progress_percent = (max_timecode_sec / duration) * 100│
│  - metadata_progress.is_complete = progress >= 90%                          │
│  - 데이터 소스: hand_analysis (파일명 매칭)                                  │
│                                                                             │
└─────────────────────────────────────────────────────────────────────────────┘
```

### 7.6 매칭 결과별 UI 상태

```
┌─────────────────────────────────────────────────────────────────────────────┐
│  Case 1: 정상 매칭 (work_summary 있음)                                       │
├─────────────────────────────────────────────────────────────────────────────┤
│  📂 WSOP-EUROPE    120개 · 25TB    [━━━━━━━━░░] 79% (95/120) 📊             │
│                                     파란색 바    텍스트 표시   시트 아이콘   │
└─────────────────────────────────────────────────────────────────────────────┘

┌─────────────────────────────────────────────────────────────────────────────┐
│  Case 2: 완료 상태 (>= 90%)                                                  │
├─────────────────────────────────────────────────────────────────────────────┤
│  📂 HCL_S1         45개 · 8TB      [━━━━━━━━━━] 100% (45/45) 📊             │
│                                     녹색 바      녹색 텍스트                 │
└─────────────────────────────────────────────────────────────────────────────┘

┌─────────────────────────────────────────────────────────────────────────────┐
│  Case 3: 매칭 없음 (work_summary = null)                                     │
├─────────────────────────────────────────────────────────────────────────────┤
│  📂 NEW_FOLDER     50개 · 10TB     [░░░░░░░░░░] -                           │
│                                     회색 빈 바   대시(-)만 표시              │
└─────────────────────────────────────────────────────────────────────────────┘

┌─────────────────────────────────────────────────────────────────────────────┐
│  Case 4: 매칭 무효화 (total_done > file_count)                               │
├─────────────────────────────────────────────────────────────────────────────┤
│  📂 PROBLEM_FOLDER 10개 · 2TB      [░░░░░░░░░░] -                           │
│                                     회색 빈 바 (매칭 무효화됨)               │
│  로그: "[MISMATCH] PROBLEM_FOLDER: total_done(50) > file_count(10)"         │
└─────────────────────────────────────────────────────────────────────────────┘
```

### 7.7 데이터 흐름 시각화

```
┌─────────────────────────────────────────────────────────────────────────────┐
│                         데이터 → UI 매핑                                     │
├─────────────────────────────────────────────────────────────────────────────┤
│                                                                             │
│  API Response (folder)                 UI Element                           │
│  ─────────────────────────────────     ──────────────────────────────────   │
│  folder.name                     →     폴더명 텍스트                         │
│  folder.file_count               →     "N개" 텍스트                          │
│  folder.size_formatted           →     "NTB" 텍스트                          │
│                                                                             │
│  work_summary.combined_progress  →     ProgressBar width %                  │
│  work_summary.combined_progress  →     진행률 텍스트 (N%)                    │
│  work_summary.total_done         →     (N/M) 텍스트의 N                      │
│  work_summary.total_files        →     (N/M) 텍스트의 M                      │
│                                                                             │
│  work_summary.sheets_excel_done  →     📊 툴팁의 분자                        │
│  work_summary.sheets_total_videos→     📊 툴팁의 분모                        │
│                                                                             │
│  work_summary = null             →     회색 빈 바 + "-" 텍스트               │
│                                                                             │
└─────────────────────────────────────────────────────────────────────────────┘
```

---

## 8. 문제 정의 및 해결 계획

**GitHub Issue**: [#29 - feat: Progress Overview - NAS/Sheets 데이터 분리 표시](https://github.com/garimto81/archive_statistics/issues/29)

### 8.1 핵심 문제

NAS 분석 데이터와 Google Sheets 분석 데이터가 혼재되어 데이터 불균형 발생

```
현재 (문제):
📂 WSOP  744개 · 125TB  [━━━░░] 65% (45/69) 📊
         ─────────────  ─────────────────────
         NAS? Sheets?    NAS? Sheets? (혼재)

변경 (목표):
📂 WSOP  (744/1912)(125TB/388TB) | [━━━░░] 65% (45/69) 📊
         ─────────────────────    ─────────────────────
              NAS 데이터              Sheets 데이터
              (순수 스캔)             (작업 현황)
```

### 8.2 데이터 소스 분리 원칙

```
┌─────────────────────────────────────────────────────────────────────────────┐
│  NAS 데이터 (folder_stats, file_stats)                                      │
├─────────────────────────────────────────────────────────────────────────────┤
│  - 소스: NAS 스캔 결과                                                       │
│  - 표시 항목:                                                                │
│    • 현재 폴더 파일 수 / 전체 파일 수                                         │
│    • 현재 폴더 용량 / 전체 용량                                               │
│  - 특징: 항상 정확함 (실제 파일 시스템 기반)                                   │
└─────────────────────────────────────────────────────────────────────────────┘

┌─────────────────────────────────────────────────────────────────────────────┐
│  Sheets 데이터 (work_statuses)                                              │
├─────────────────────────────────────────────────────────────────────────────┤
│  - 소스: Google Sheets 동기화                                                │
│  - 표시 항목:                                                                │
│    • 진행률 바 (excel_done / total_videos * 100)                            │
│    • 완료/전체 텍스트 (excel_done / total_videos)                            │
│  - 특징: 매칭이 필요함 (category ↔ folder.name)                              │
│  - 문제: 매칭 실패 시 표시 안됨                                               │
└─────────────────────────────────────────────────────────────────────────────┘
```

### 8.3 구현 계획

#### Phase 1: NAS 데이터 무결성 표시 (우선)

**목표**: NAS 데이터는 항상 정확하게 표시

| 항목 | 현재 | 변경 |
|------|------|------|
| 파일 수 | `744개` | `(744/1912)` - 현재 폴더/전체 |
| 용량 | `125TB` | `(125TB/388TB)` - 현재 폴더/전체 |

**작업 내용**:
- [ ] Backend: 루트 기준 전체 파일 수/용량 계산 API 추가
- [ ] Frontend: FolderNode에 전체 대비 비율 표시
- [ ] 테스트: NAS 데이터 정확성 검증

#### Phase 2: Sheets 데이터 분리 표시

**목표**: Sheets 데이터는 별도 영역에 명확히 표시

| 항목 | 현재 | 변경 |
|------|------|------|
| 진행률 | 혼재 표시 | `|` 구분자 뒤에 표시 |
| 매칭 상태 | 암묵적 | 매칭 없으면 `-` 명시 |

**작업 내용**:
- [ ] Frontend: UI 레이아웃 분리 (NAS | Sheets)
- [ ] Backend: 매칭 로직 검증 및 수정
- [ ] 매칭 실패 시 명확한 피드백 UI

### 8.4 UI 목업 (변경 후)

```
┌─────────────────────────────────────────────────────────────────────────────┐
│  Progress Overview                                                    [↻]   │
├─────────────────────────────────────────────────────────────────────────────┤
│  범례: [NAS] 파일/용량  |  [Sheets] 진행률                                   │
├─────────────────────────────────────────────────────────────────────────────┤
│                                                                             │
│  ▼ 📂 WSOP       (744/1912)(125TB/388TB) | [━━━━━━━░░░] 65% (45/69) 📊     │
│     ▼ 📂 WSOP-EU (120/744)(25TB/125TB)   | [━━━━━━━━░░] 79% (95/120) 📊    │
│     ▶ 📂 WSOP-LV (200/744)(40TB/125TB)   | [━━━━━━━━━━] 100% (80/80) 📊    │
│     ▶ 📂 WSOP-PA (50/744)(12TB/125TB)    | [░░░░░░░░░░] 0% (0/50) 📊       │
│                                                                             │
│  ▶ 📂 HCL        (500/1912)(80TB/388TB)  | [━━━━━━━━━━] 100%               │
│                                                                             │
│  ▶ 📂 PAD        (180/1912)(35TB/388TB)  | - (매칭 없음)                    │
│                                                                             │
└─────────────────────────────────────────────────────────────────────────────┘

구분:
├── NAS 영역: (현재/상위)(용량/상위) ──┤── Sheets 영역: [바] N% (done/total) ──┤
```

### 8.5 검증 기준

| Phase | 검증 항목 | 기대 결과 |
|-------|----------|----------|
| 1 | 루트 폴더 파일 수 | 전체 NAS 파일 수와 일치 |
| 1 | 하위 폴더 파일 수 | 부모 파일 수의 부분합 |
| 2 | 매칭된 폴더 | 진행률 바 + % 표시 |
| 2 | 매칭 안된 폴더 | `- (매칭 없음)` 표시 |

---

## 변경 이력

| 버전 | 날짜 | 변경 내용 |
|------|------|----------|
| 1.2.0 | 2025-12-12 | 문제 정의 및 해결 계획 추가 (Issue #29) |
| 1.1.0 | 2025-12-12 | 목업 디자인 추가 (섹션 7) |
| 1.0.0 | 2025-12-12 | 초안 작성 - 구조 분석 및 질문 정리 |
